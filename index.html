<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wards在线 | Player Analytics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            transition: all 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            background: rgba(30, 30, 30, 0.8);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
            overflow: hidden;
            padding: 25px;
            position: relative;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(218, 165, 32, 0.3);
        }
        
        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: rgba(40, 40, 40, 0.9);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            color: #DAA520;
            font-weight: 500;
            border: 1px solid rgba(218, 165, 32, 0.4);
        }
        
        .lang-btn:hover {
            background: rgba(60, 60, 60, 0.9);
        }
        
        .lang-btn.active {
            background: rgba(218, 165, 32, 0.2);
            color: #FFD700;
            border-color: #DAA520;
        }
        
        header {
            text-align: center;
            padding: 30px 0 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(218, 165, 32, 0.3);
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 10px;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(218, 165, 32, 0.5);
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: #DAA520;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 900px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .stats-card {
            background: rgba(40, 40, 40, 0.7);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(218, 165, 32, 0.4);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #DAA520, #FFD700);
        }
        
        .stats-title {
            font-size: 1.2rem;
            color: #DAA520;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .stats-value {
            font-size: 3.5rem;
            font-weight: 300;
            color: #FFD700;
            line-height: 1;
            margin: 15px 0;
            text-shadow: 0 0 10px rgba(218, 165, 32, 0.3);
        }
        
        .stats-label {
            color: #DAA520;
            font-size: 1rem;
            margin-top: 10px;
        }
        
        .stats-comparison {
            font-size: 0.9rem;
            color: #B8860B;
            margin-top: 10px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #DAA520, #B8860B);
            color: #000;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 5px 15px rgba(218, 165, 32, 0.3);
            transition: all 0.3s ease;
            border: 1px solid rgba(218, 165, 32, 0.5);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(218, 165, 32, 0.5);
            background: linear-gradient(135deg, #FFD700, #DAA520);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .last-updated {
            text-align: center;
            color: #B8860B;
            margin-top: 5px;
            font-size: 0.9rem;
        }
        
        .data-highlights {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        @media (max-width: 900px) {
            .data-highlights {
                grid-template-columns: 1fr;
            }
        }
        
        .highlight-card {
            background: rgba(40, 40, 40, 0.7);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(218, 165, 32, 0.4);
            text-align: center;
        }
        
        .highlight-title {
            font-size: 1rem;
            color: #DAA520;
            margin-bottom: 10px;
        }
        
        .highlight-value {
            font-size: 2rem;
            font-weight: 300;
            color: #FFD700;
            margin: 10px 0;
        }
        
        .highlight-change {
            font-size: 0.9rem;
            color: #B8860B;
        }
        
        .info-section {
            background: rgba(40, 40, 40, 0.7);
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            border: 1px solid rgba(218, 165, 32, 0.4);
        }
        
        .info-title {
            font-size: 1.1rem;
            color: #DAA520;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-content {
            color: #B8860B;
            line-height: 1.6;
            font-size: 0.95rem;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            color: #B8860B;
            font-size: 0.85rem;
            border-top: 1px solid rgba(218, 165, 32, 0.3);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(218, 165, 32, .3);
            border-radius: 50%;
            border-top-color: #DAA520;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .positive-change {
            color: #32CD32;
        }
        
        .negative-change {
            color: #DC143C;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .stats-value {
                font-size: 3rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        .error-message {
            color: #DC143C;
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(220, 20, 60, 0.1);
            border-radius: 5px;
            border: 1px solid rgba(220, 20, 60, 0.3);
        }
        
        .servers-container {
            margin-top: 30px;
        }
        
        .server-card {
            background: rgba(40, 40, 40, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(218, 165, 32, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .server-info {
            display: flex;
            flex-direction: column;
        }
        
        .server-name {
            font-size: 1.1rem;
            color: #DAA520;
        }
        
        .server-stats {
            display: flex;
            gap: 20px;
        }
        
        .server-stat {
            text-align: center;
        }
        
        .server-stat-value {
            font-size: 1.5rem;
            color: #FFD700;
        }
        
        .server-stat-label {
            font-size: 0.8rem;
            color: #B8860B;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="language-switcher">
            <button class="lang-btn active" id="lang-zh">繁體中文</button>
            <button class="lang-btn" id="lang-en">English</button>
        </div>
        
        <header>
            <h1 id="title"><i class="fas fa-crown"></i> 玩家統計</h1>
            <p class="subtitle" id="subtitle">實時追踪玩家數據與服務器狀態</p>
        </header>
        
        <div id="errorContainer" style="display: none;" class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="errorText">數據加載失敗，請稍後再試</span>
        </div>
        
        <div class="dashboard">
            <div class="stats-card">
                <div class="stats-title" id="onlineTitle">
                    <i class="fas fa-users"></i>
                    <span>當前在線玩家</span>
                </div>
                <div class="stats-value" id="onlinePlayers">
                    <div class="loading"></div>
                </div>
                <div class="stats-label" id="onlineLabel">當前在遊戲中的玩家數量</div>
                <div class="stats-comparison" id="onlineComparison">服務器負載: <span id="serverLoad">計算中...</span></div>
            </div>
            
            <div class="stats-card">
                <div class="stats-title" id="totalTitle">
                    <i class="fas fa-chart-line"></i>
                    <span>總玩家數</span>
                </div>
                <div class="stats-value" id="totalPlayers">
                    <div class="loading"></div>
                </div>
                <div class="stats-label" id="totalLabel">已註冊的玩家總數</div>
                <div class="stats-comparison" id="totalComparison">在線率: <span id="onlineRate">計算中...</span></div>
            </div>
            
            <div class="stats-card">
                <div class="stats-title" id="newPlayersTitle">
                    <i class="fas fa-user-plus"></i>
                    <span>今日新增玩家</span>
                </div>
                <div class="stats-value" id="newPlayers">
                    <div class="loading"></div>
                </div>
                <div class="stats-label" id="newPlayersLabel">今日首次登錄的玩家數量</div>
                <div class="stats-comparison" id="newPlayersComparison">與昨日: <span id="newPlayersChange">計算中...</span></div>
            </div>
        </div>
        
        <div class="controls">
            <button id="refreshBtn" class="btn">
                <i class="fas fa-sync-alt"></i> <span id="refreshText">刷新數據</span>
            </button>
            <button id="exportBtn" class="btn">
                <i class="fas fa-download"></i> <span id="exportText">導出數據</span>
            </button>
            <button id="resetBtn" class="btn">
                <i class="fas fa-trash-alt"></i> <span id="resetText">重置日活數據</span>
            </button>
        </div>
        
        <div class="last-updated">
            <p id="lastUpdatedText">最後更新: <span id="lastUpdated">加載中...</span></p>
        </div>
        
        <div class="data-highlights">
            <div class="highlight-card">
                <div class="highlight-title" id="serversTitle">服務器數量</div>
                <div class="highlight-value" id="serversCount">
                    <div class="loading" style="width: 16px; height: 16px;"></div>
                </div>
                <div class="highlight-change" id="serversStatus">運行中</div>
            </div>
            
            <div class="highlight-card">
                <div class="highlight-title" id="avgOnlineTitle">平均在線</div>
                <div class="highlight-value" id="avgOnlineValue">
                    <div class="loading" style="width: 16px; height: 16px;"></div>
                </div>
                <div class="highlight-change" id="avgOnlineChange">每服務器平均在線玩家</div>
            </div>
            
            <div class="highlight-card">
                <div class="highlight-title" id="peakTitle">峰值在線</div>
                <div class="highlight-value" id="peakValue">
                    <div class="loading" style="width: 16px; height: 16px;"></div>
                </div>
                <div class="highlight-change" id="peakChange">單服務器最高在線</div>
            </div>
        </div>
        
        <div class="servers-container" id="serversContainer">
            <h3 class="info-title">
                <i class="fas fa-server"></i>
                <span id="serversListTitle">服務器列表</span>
            </h3>
            <div id="serversList">
                <!-- 服务器列表将在这里动态生成 -->
            </div>
        </div>
        
        <div class="info-section">
            <h3 class="info-title">
                <i class="fas fa-info-circle"></i>
                <span id="infoTitle">數據說明</span>
            </h3>
            <div class="info-content" id="infoContent">
                <p><strong>當前在線玩家</strong>: 指當前正在遊戲中的玩家數量。</p>
                <p><strong>總玩家數</strong>: 指已註冊的玩家總數。</p>
                <p><strong>今日新增玩家</strong>: 指今日首次登錄遊戲的玩家數量。</p>
                <p><strong>數據來源</strong>: 服務器API接口實時統計，每5分鐘更新一次。</p>
            </div>
        </div>
        
        <div class="footer">
            <p id="footerText">玩家統計系統 &copy; 2023 | 數據實時更新</p>
        </div>
    </div>

    <script>
        // 实时数据API URL
        const DATA_API_URL = 'https://raw.githubusercontent.com/xiaodao1337/wards-web/main/data.json';
        
        // 存储历史数据用于计算变化
        let previousData = null;
        
        // 存储日活用户ID
        let dailyActiveUsers = new Set();
        
        // 存储今日新增用户ID
        let todayNewUsers = new Set();
        
        // 存储历史用户ID
        let historicalUsers = new Set();
        
        // 语言数据
        const translations = {
            "zh": {
                "title": "Wards在线",
                "subtitle": "實時追踪玩家數據與服務器狀態",
                "onlineTitle": "當前在線玩家",
                "onlineLabel": "當前在遊戲中的玩家數量",
                "totalTitle": "總玩家數",
                "totalLabel": "已註冊的玩家總數",
                "newPlayersTitle": "今日新增玩家",
                "newPlayersLabel": "今日首次登錄的玩家數量",
                "refreshText": "刷新數據",
                "exportText": "導出數據",
                "resetText": "重置日活數據",
                "lastUpdatedText": "最後更新:",
                "serversTitle": "玩家人数",
                "peakTitle": "热门服务器",
                "serversListTitle": "Wards在线",
                "infoTitle": "數據說明",
                "infoContent": `
                    <p><strong>當前在線玩家</strong>: 指當前正在遊戲中的玩家數量。</p>
                    <p><strong>總玩家數</strong>: 指已註冊的玩家總數。</p>
                    <p><strong>今日新增玩家</strong>: 指今日首次登錄遊戲的玩家數量。</p>
                    <p><strong>數據來源</strong>: 服務器API接口實時統計，每5分鐘更新一次。</p>
                `,
                "footerText": "玩家統計系統 &copy; 2025 | 數據實時更新",
                "loading": "加載中...",
                "increase": "增加",
                "decrease": "減少",
                "noData": "暫無數據",
                "serversStatus": "運行中",
                "peakChange": "热门服务器",
                "errorText": "數據加載失敗，請稍後再試",
                "server": "玩家",
                "online": "热门服务器",
                "total": "卡组代码",
                "resetConfirm": "確定要重置日活數據嗎？這將清除所有今日記錄的玩家數據。",
                "resetSuccess": "日活數據已重置"
            },
            "en": {
                "title": "Player Analytics",
                "subtitle": "Real-time player data and server status tracking",
                "onlineTitle": "Online Players",
                "onlineLabel": "Players currently in game",
                "totalTitle": "Total Players",
                "totalLabel": "Total registered players",
                "newPlayersTitle": "Today's New Players",
                "newPlayersLabel": "Players who logged in for the first time today",
                "refreshText": "Refresh Data",
                "exportText": "Export Data",
                "resetText": "Reset Daily Data",
                "lastUpdatedText": "Last Updated:",
                "serversTitle": "Servers",
                "avgOnlineTitle": "Avg Online",
                "peakTitle": "Peak Online",
                "serversListTitle": "Server List",
                "infoTitle": "Data Information",
                "infoContent": `
                    <p><strong>Online Players</strong>: Number of players currently in the game.</p>
                    <p><strong>Total Players</strong>: Total number of registered players.</p>
                    <p><strong>Today's New Players</strong>: Number of players who logged in for the first time today.</p>
                    <p><strong>Data Source</strong>: Real-time statistics from server API, updated every 5 minutes.</p>
                `,
                "footerText": "Player Analytics System &copy; 2023 | Real-time Updates",
                "loading": "Loading...",
                "increase": "increase",
                "decrease": "decrease",
                "noData": "No data available",
                "serversStatus": "Running",
                "avgOnlineChange": "Average players per server",
                "peakChange": "Highest online on a single server",
                "errorText": "Failed to load data, please try again later",
                "server": "Server",
                "online": "Online",
                "total": "Total",
                "resetConfirm": "Are you sure you want to reset daily data? This will clear all player data recorded today.",
                "resetSuccess": "Daily data has been reset"
            }
        };
        
        // 当前语言
        let currentLang = "zh";
        
        // 存储最新数据
        let latestData = null;
        
        // 从localStorage加载数据
        function loadStoredData() {
            try {
                const storedDailyUsers = localStorage.getItem('dailyActiveUsers');
                const storedTodayNewUsers = localStorage.getItem('todayNewUsers');
                const storedHistoricalUsers = localStorage.getItem('historicalUsers');
                
                if (storedDailyUsers) {
                    dailyActiveUsers = new Set(JSON.parse(storedDailyUsers));
                }
                
                if (storedTodayNewUsers) {
                    todayNewUsers = new Set(JSON.parse(storedTodayNewUsers));
                }
                
                if (storedHistoricalUsers) {
                    historicalUsers = new Set(JSON.parse(storedHistoricalUsers));
                }
                
                // 检查是否需要重置日活数据（如果是新的一天）
                const lastResetDate = localStorage.getItem('lastResetDate');
                const today = new Date().toDateString();
                
                if (lastResetDate !== today) {
                    resetDailyData();
                    localStorage.setItem('lastResetDate', today);
                }
            } catch (e) {
                console.error("Error loading stored data:", e);
            }
        }
        
        // 保存数据到localStorage
        function saveStoredData() {
            try {
                localStorage.setItem('dailyActiveUsers', JSON.stringify(Array.from(dailyActiveUsers)));
                localStorage.setItem('todayNewUsers', JSON.stringify(Array.from(todayNewUsers)));
                localStorage.setItem('historicalUsers', JSON.stringify(Array.from(historicalUsers)));
            } catch (e) {
                console.error("Error saving data to localStorage:", e);
            }
        }
        
        // 重置日活数据
        function resetDailyData() {
            dailyActiveUsers.clear();
            todayNewUsers.clear();
            saveStoredData();
            
            // 更新页面显示
            document.getElementById('newPlayers').textContent = "0";
            document.getElementById('newPlayersChange').textContent = "0";
            
            alert(translations[currentLang].resetSuccess);
        }
        
        // 从API获取实时数据
        async function fetchRealTimeData() {
            try {
                hideError();
                showLoadingState();
                
                const response = await fetch(DATA_API_URL + '?t=' + new Date().getTime());
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // 更新页面数据
                updatePageWithData(data);
                
                // 存储最新数据
                latestData = data;
                
            } catch (error) {
                console.error("Error fetching data:", error);
                showError(translations[currentLang].errorText);
            }
        }
        
        // 使用数据更新页面
        function updatePageWithData(data) {
            // 更新最后更新时间
            const now = new Date();
            const formattedDate = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
            document.getElementById('lastUpdated').textContent = formattedDate;
            
            // 解析数据
            // 根据提供的信息，数据格式为: {"online":[["1939",8975,100366]],"total":1429}
            const totalPlayers = data.total || 0;
            const onlineData = data.online || [];
            
            // 提取所有用户ID
            const userIds = onlineData.map(player => player[0].toString());
            
            // 计算当前在线玩家总数
            const onlinePlayers = userIds.length;
            
            // 计算服务器总数
            const serversCount = onlineData.length;
            
            // 计算平均在线玩家数
            const avgOnline = serversCount > 0 ? (onlinePlayers / serversCount).toFixed(1) : 0;
            
            // 找到峰值在线服务器
            let peakOnline = 0;
            onlineData.forEach(server => {
                if (server[1] > peakOnline) {
                    peakOnline = server[1];
                }
            });
            
            // 计算服务器负载 (在线玩家/总玩家)
            const serverLoad = totalPlayers > 0 ? ((onlinePlayers / totalPlayers) * 100).toFixed(1) + '%' : '0%';
            
            // 计算在线率
            const onlineRate = totalPlayers > 0 ? ((onlinePlayers / totalPlayers) * 100).toFixed(1) + '%' : '0%';
            
            // 更新日活用户和新增用户
            let newPlayersCount = 0;
            
            userIds.forEach(userId => {
                // 添加到日活用户
                if (!dailyActiveUsers.has(userId)) {
                    dailyActiveUsers.add(userId);
                }
                
                // 检查是否是新增用户（不在历史用户中）
                if (!historicalUsers.has(userId)) {
                    historicalUsers.add(userId);
                    todayNewUsers.add(userId);
                    newPlayersCount++;
                }
            });
            
            // 保存更新后的数据
            saveStoredData();
            
            // 更新主要统计数据
            document.getElementById('onlinePlayers').textContent = onlinePlayers.toLocaleString();
            document.getElementById('totalPlayers').textContent = totalPlayers.toLocaleString();
            document.getElementById('newPlayers').textContent = todayNewUsers.size.toLocaleString();
            
            // 更新服务器负载和在线率
            document.getElementById('serverLoad').textContent = serverLoad;
            document.getElementById('onlineRate').textContent = onlineRate;
            
            // 更新其他数据卡片
            document.getElementById('serversCount').textContent = serversCount;
            document.getElementById('avgOnlineValue').textContent = avgOnline;
            document.getElementById('peakValue').textContent = peakOnline.toLocaleString();
            
            // 更新新增玩家变化
            const newPlayersChangeElement = document.getElementById('newPlayersChange');
            if (previousData && previousData.todayNewUsers) {
                const change = todayNewUsers.size - previousData.todayNewUsers;
                if (change > 0) {
                    newPlayersChangeElement.innerHTML = `<span class="positive-change">+${change}</span>`;
                } else if (change < 0) {
                    newPlayersChangeElement.innerHTML = `<span class="negative-change">${change}</span>`;
                } else {
                    newPlayersChangeElement.innerHTML = `<span>0</span>`;
                }
            } else {
                newPlayersChangeElement.innerHTML = `<span>0</span>`;
            }
            
            // 更新服务器列表
            updateServersList(onlineData);
            
            // 存储当前数据作为下一次比较的基础
            previousData = {
                onlinePlayers,
                totalPlayers,
                todayNewUsers: todayNewUsers.size,
                timestamp: now.getTime()
            };
        }
        
        // 更新服务器列表
        function updateServersList(serversData) {
            const serversList = document.getElementById('serversList');
            serversList.innerHTML = '';
            
            serversData.forEach(server => {
                const serverId = server[0] || '未知';
                const online = server[1] || 0;
                const total = server[2] || 0;
                
                const serverElement = document.createElement('div');
                serverElement.className = 'server-card';
                serverElement.innerHTML = `
                    <div class="server-info">
                        <div class="server-name">${translations[currentLang].server} ${serverId}</div>
                    </div>
                    <div class="server-stats">
                        <div class="server-stat">
                            <div class="server-stat-value">${online.toLocaleString()}</div>
                            <div class="server-stat-label">${translations[currentLang].online}</div>
                        </div>
                        <div class="server-stat">
                            <div class="server-stat-value">${total.toLocaleString()}</div>
                            <div class="server-stat-label">${translations[currentLang].total}</div>
                        </div>
                    </div>
                `;
                
                serversList.appendChild(serverElement);
            });
        }
        
        // 显示加载状态
        function showLoadingState() {
            const loadingElements = document.querySelectorAll('.stats-value, .highlight-value');
            loadingElements.forEach(el => {
                if (!el.querySelector('.loading')) {
                    const loadingDiv = document.createElement('div');
                    loadingDiv.className = 'loading';
                    el.innerHTML = '';
                    el.appendChild(loadingDiv);
                }
            });
            
            document.getElementById('lastUpdated').textContent = translations[currentLang].loading;
        }
        
        // 显示错误信息
        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            const errorText = document.getElementById('errorText');
            
            errorText.textContent = message;
            errorContainer.style.display = 'block';
        }
        
        // 隐藏错误信息
        function hideError() {
            document.getElementById('errorContainer').style.display = 'none';
        }
        
        // 切换语言
        function setLanguage(lang) {
            currentLang = lang;
            
            // 更新语言按钮状态
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`lang-${lang}`).classList.add('active');
            
            // 更新页面文本
            document.getElementById('title').innerHTML = `<i class="fas fa-crown"></i> ${translations[lang].title}`;
            document.getElementById('subtitle').textContent = translations[lang].subtitle;
            document.getElementById('onlineTitle').innerHTML = `<i class="fas fa-users"></i> <span>${translations[lang].onlineTitle}</span>`;
            document.getElementById('onlineLabel').textContent = translations[lang].onlineLabel;
            document.getElementById('totalTitle').innerHTML = `<i class="fas fa-chart-line"></i> <span>${translations[lang].totalTitle}</span>`;
            document.getElementById('totalLabel').textContent = translations[lang].totalLabel;
            document.getElementById('newPlayersTitle').innerHTML = `<i class="fas fa-user-plus"></i> <span>${translations[lang].newPlayersTitle}</span>`;
            document.getElementById('newPlayersLabel').textContent = translations[lang].newPlayersLabel;
            document.getElementById('refreshText').textContent = translations[lang].refreshText;
            document.getElementById('exportText').textContent = translations[lang].exportText;
            document.getElementById('resetText').textContent = translations[lang].resetText;
            document.getElementById('lastUpdatedText').innerHTML = `${translations[lang].lastUpdatedText} <span id="lastUpdated">${translations[lang].loading}</span>`;
            document.getElementById('serversTitle').textContent = translations[lang].serversTitle;
            document.getElementById('avgOnlineTitle').textContent = translations[lang].avgOnlineTitle;
            document.getElementById('peakTitle').textContent = translations[lang].peakTitle;
            document.getElementById('serversListTitle').textContent = translations[lang].serversListTitle;
            document.getElementById('infoTitle').textContent = translations[lang].infoTitle;
            document.getElementById('infoContent').innerHTML = translations[lang].infoContent;
            document.getElementById('footerText').textContent = translations[lang].footerText;
            document.getElementById('errorText').textContent = translations[lang].errorText;
            document.getElementById('serversStatus').textContent = translations[lang].serversStatus;
            document.getElementById('avgOnlineChange').textContent = translations[lang].avgOnlineChange;
            document.getElementById('peakChange').textContent = translations[lang].peakChange;
            
            // 如果有数据，重新渲染服务器列表以更新语言
            if (latestData) {
                updateServersList(latestData.online || []);
            }
        }
        
        // 导出数据
        function exportData() {
            if (!latestData) {
                alert(currentLang === "zh" ? "暫無數據可導出" : "No data available to export");
                return;
            }
            
            const exportData = {
                timestamp: new Date().toISOString(),
                onlinePlayers: document.getElementById('onlinePlayers').textContent,
                totalPlayers: document.getElementById('totalPlayers').textContent,
                newPlayers: document.getElementById('newPlayers').textContent,
                serversCount: document.getElementById('serversCount').textContent,
                avgOnline: document.getElementById('avgOnlineValue').textContent,
                peakOnline: document.getElementById('peakValue').textContent,
                rawData: latestData
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `player-data-${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 加载存储的数据
            loadStoredData();
            
            // 设置语言切换事件
            document.getElementById('lang-zh').addEventListener('click', () => setLanguage('zh'));
            document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));
            
            // 设置按钮事件
            document.getElementById('refreshBtn').addEventListener('click', function() {
                fetchRealTimeData();
            });
            
            document.getElementById('exportBtn').addEventListener('click', exportData);
            
            document.getElementById('resetBtn').addEventListener('click', function() {
                if (confirm(translations[currentLang].resetConfirm)) {
                    resetDailyData();
                }
            });
            
            // 设置默认语言并获取初始数据
            setLanguage('zh');
            fetchRealTimeData();
            
            // 每5分钟自动刷新数据
            setInterval(fetchRealTimeData, 5 * 60 * 1000);
        });
    </script>
</body>
</html>
